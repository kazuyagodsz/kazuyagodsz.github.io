var show_fname_chars=72,form_action,UID,interval,enccx,fsize,fmd5;function $$(t){return document.getElementById(t)}function fileSelected(t){if(checkExt(t.value)){var e=$(t).prop("files"),i=Array(),o=Array(),n=0;if($.map(e,(function(t){fsize=t.size,n+=fsize,i.push(t.name),o.push(`${t.name} (${Math.round(fsize/1024/1024)} Mb)`),"undefined"!=typeof auto_md5_upload&&auto_md5_upload&&1==e.length&&hashMe(t,(function(t){console.log(t),fmd5=t}))})),n>536870912e3)return alert("Total size of selected files should not exceed 500 Gbytes"),void(t.value="");if(i.length>1)$(t).parents("table").find(".onefile").remove();else{var r=i[0].split(/[\.\_\-]+/),a=/^(avi|mkv|mpg|mpeg|mov|divx|dvdrip|bdrip|mp4|flv|vob)$/i;r=jQuery.grep(r,(function(t){return!a.test(t)}))}$("#upload-title").html(i.join("\r\n")),$("#upload-files .block-bg").html(i.join("<br>")),$(t).parent().hide(),$("#upload-files").show()}}function openStatusWindow(t,e,i){$("#utmodes").hide(),$("#progress").show(),$("#div_file").css("visibility","hidden");var o=new Date;time_start=o.getTime(),interval=window.setInterval((function(){progressUpdate(e)}),1e3),$("#pbon").click((function(t){t.preventDefault(),"on"==$(this).html()?($(this).html("off"),window.clearTimeout(interval)):($(this).html("on"),interval=window.setInterval((function(){progressUpdate(e)}),1e3))}))}function StartUpload(t){form_action=getFormAction(t),t.target="xupload";var e=0,i=new Array;$('.upload_slot input[type="checkbox"]:not(:checked)').each((function(t){$(this).append("<input type='hidden' value='0' name='"+$(this).prop("name")+"'>")}));var o=0,n=0;if($('input[type="file"][name="file"]').each((function(t){$(this).val()&&0==$('select[name="cat_id"]:eq('+t+")").val()&&(n=1),$(this).val()&&(checkExt($(this).val())||(o=1),name=$(this).val().match(/[^\\\/]+$/),name&&"null"!=name&&(i.push(name),e++))})),o)return!1;if(n&&category_required)return alert(lng_uploadform_choose_category),!1;if(e<=0)return alert(lng_uploadform_select_file_to_upload),!1;if(t.tos&&!t.tos.checked)return alert(lng_uploadform_agree_to_tos),!1;UID="";for(var r=0;r<12;r++)UID+=""+Math.floor(10*Math.random());if(openStatusWindow(t,UID,i.join(", ")),form_action=form_action.split("?")[0]+"?X-Progress-ID="+UID,setFormAction(t,form_action),t.action=form_action,fsize&&fmd5){var a=$(t).serialize();return console.log(a),a+="&op=ajax_find_copies",a+="&size="+fsize,a+="&md5="+fmd5,$.post("/",a,(function(e){e.match(/^\//i)?window.location=e:t.submit()})),!1}$(".upload_slot, #submit_btn").hide()}function checkExt(t){if(""==t)return!0;var e=new RegExp("^.+.("+ext_allowed+")$","i");return!(ext_allowed&&!e.test(t))||(str="",ext_allowed&&(str+="\n"+lng_uploadform_only_these_ext_allowed+" "+ext_allowed.replace(/\|/g,",")),alert(lng_uploadform_ext_not_allowed+' "'+t+'"'+str),!1)}function fixLength(t){var e=t.split(/\\/);return(t=e[e.length-1]).length<show_fname_chars?t:"..."+t.substring(t.length-show_fname_chars-1,t.length)}function getFormAction(t){if(t){for(i=0;i<=t.attributes.length;i++)if(t.attributes[i]&&"action"==t.attributes[i].name.toLowerCase())return t.attributes[i].value;return""}}function setFormAction(t,e){for(i=0;i<=t.attributes.length;i++)t.attributes[i]&&"action"==t.attributes[i].name.toLowerCase()&&(t.attributes[i].value=e)}function InitUploadSelector(t,e,i){$$(t)&&new MultiSelector(t,i).addElement($$(e))}function findPos(t){var e=curtop=0;if(t.offsetParent)do{e+=t.offsetLeft,curtop+=t.offsetTop}while(t=t.offsetParent);return[e,curtop]}function changeUploadType(t){$$("div_file").style.position="absolute",$$("div_url")&&($$("div_url").style.position="absolute"),$$("div_rs")&&($$("div_rs").style.position="absolute"),$$("div_tt")&&($$("div_tt").style.position="absolute"),$$("div_ff")&&($$("div_ff").style.position="absolute"),$$("div_"+t).style.position="static",$("#utmodes > input.active").removeClass("active"),$("#r_"+t).addClass("active")}function jah(url,id,silent){var obj;return id&&(obj=null!==id&&"object"==typeof id?id:$("#"+id)),obj&&!silent&&obj.html("..."),$.get(url,(function(data){obj?obj.html(data):eval(data)})),!1}function scaleImg(t){if(t.width>800)return w=t.width,h=t.height,wn=800,hn=parseInt(800*t.height/t.width),t.width=wn,t.height=hn,void(t.onclick=function(){this.width==wn?(this.width=w,this.height=h):(this.width=wn,this.height=hn)})}function OpenWin(t,e,i){return e||(e=720),i||(i=700),window.open(t,null,"width="+e+",height="+i+",status=no,scrollbars=yes,resizable=yes,left=450,top=250").focus(),!1}function player_start(){return!1}function copy(t){t.focus(),t.select()}function convertSeconds(t){var e=t%60,i=(t-e)%3600/60,o=(t-e-60*i)%86400/3600;return o>0?o+" hours "+i+" minutes":i>0?i+" minutes "+e+" seconds":e+" seconds"}function convertSize(t){return t>1073741824?t=Math.round(t/1073741824*10)/10+" Gb":t>1048576?((t=Math.round(t/1048576*10)/10+"").match(/\./)||(t+=".0"),t+=" Mb"):t>1024?t=Math.round(t/1024*10)/10+" Kb":t+=" Bytes",t}function SP(t,e,i,o){var n=parseInt(100*parseFloat(t)/parseFloat(e));$("#upload_status").animate({width:n+"%"},1e3,"linear"),$("#percent").html(n+"%"),$("#cursize").html(convertSize(t)),$("#totalsize").html(convertSize(e)),$("#speed").html(i),$("#estimate").html(convertSeconds(o)),document.title=n+"% uploaded"}function progressUpdate(t){var e=0;$.getJSON(srv_htdocs_url+"/progress?X-Progress-ID="+t+"&callback=?",{format:"json"}).fail((function(){window.clearTimeout(interval),$("#progress_msg").html("Uploading...")})).done((function(t){if("uploading"==t.state){if(total&&""!=total||(total=t.size,$("#progress_info").show(),$("#progress_msg").html("")),t.received>=t.size)return SP(total,total,0,0),$("#progress_info").hide(),$("#progress_msg").html("Generating links..."),void window.clearTimeout(interval);e=1e3*t.received/((new Date).getTime()-time_start),est=Math.round((t.size-t.received)/e),e=Math.round(e/1024),SP(t.received,t.size,e,est)}else"done"==t.state?(SP(t.size,t.size,0,0),$("#progress_info").hide(),$("#progress_msg").html("Generating links..."),window.clearTimeout(interval)):"error"==t.state&&($("#progress_msg").html(t.msg),window.clearTimeout(interval),loc=top.window.location+"")}))}function download_video(t,e,i){window.location="/dl?op=download_orig&id="+t+"&mode="+e+"&hash="+i}function encStatus(t,e){e&&(enccx=e,$("#enc_pp")&&setInterval("encStatus("+t+")",15e3)),++enccx>1e3||$.get("/dl?op=enc_status&id="+t,(function(){}),"script")}$(document).ready((function(){})),$.fn.shiftSelectable=function(){var t,e=this;e.click((function(i){if(t){if(i.shiftKey){var o=e.index(this),n=e.index(t);e.slice(Math.min(o,n),Math.max(o,n)+1).prop("checked",t.checked).trigger("change")}t=this}else t=this}))};